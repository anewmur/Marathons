2025-12-19 17:35:39 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:35:39 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:35:39 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.249s, null_city=4304
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.055s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.147s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:35:39 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.062s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:35:40 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.868s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:35:40 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.004s)
2025-12-19 17:35:40 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.047s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:35:40 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.056s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:35:40 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.031s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:35:40 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.148s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.026s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.106s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:35:41 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.865s
2025-12-19 17:35:41 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.87s
2025-12-19 17:35:41 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.06s, validation_year=2025
2025-12-19 17:35:41 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:35:41 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.35s, groups=10
2025-12-19 17:35:41 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:35:52 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:35:52 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:35:53 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:35:53 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:35:53 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:35:53 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:35:53 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:35:53 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.52s, races=5
2025-12-19 17:35:53 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:35:53 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:35:53 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:35:53 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.047s
2025-12-19 17:35:53 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.12s, validation_year=2025
2025-12-19 17:36:08 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:36:08 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 17:36:08 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:36:08 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:36:08 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:36:09 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.263s, null_city=4304
2025-12-19 17:36:09 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.041s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:36:09 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:36:09 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.159s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:36:09 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.065s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.893s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:36:10 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.060s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.035s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.164s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.027s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.111s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.020s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:36:10 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.937s
2025-12-19 17:36:10 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.94s
2025-12-19 17:36:10 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 17:36:11 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:36:11 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.34s, groups=10
2025-12-19 17:36:11 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:36:22 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:36:23 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:36:23 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.51s, races=5
2025-12-19 17:36:23 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:36:23 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:36:23 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:36:23 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.032s
2025-12-19 17:36:23 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 17:37:00 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:37:00 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:37:00 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.243s, null_city=4304
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.039s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.149s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:37:00 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.061s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:37:01 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.868s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:37:01 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 17:37:01 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.046s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:37:01 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.054s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:37:01 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.031s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:37:01 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.155s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.029s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.115s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:37:02 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.864s
2025-12-19 17:37:02 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.87s
2025-12-19 17:37:02 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 17:37:02 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:37:02 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.35s, groups=10
2025-12-19 17:37:02 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:37:15 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:37:15 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:37:16 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:37:16 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:37:16 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:37:16 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:37:16 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:37:16 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.50s, races=5
2025-12-19 17:37:16 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:37:16 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:37:16 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:37:16 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.034s
2025-12-19 17:37:16 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 17:37:36 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:37:36 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:37:36 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:37:36 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:37:36 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.008s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:37:36 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.250s, null_city=4304
2025-12-19 17:37:36 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.040s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:37:36 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:37:37 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.149s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:37:37 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.068s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.869s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:37:38 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.004s)
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.043s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.030s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.168s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.025s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.111s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:37:38 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.878s
2025-12-19 17:37:38 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.88s
2025-12-19 17:37:38 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 17:37:38 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:37:38 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.32s, groups=10
2025-12-19 17:37:39 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:37:49 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:37:49 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:37:50 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:37:50 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:37:50 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:37:50 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:37:50 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:37:50 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.40s, races=5
2025-12-19 17:37:50 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:37:50 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:37:50 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:37:50 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.031s
2025-12-19 17:37:50 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 17:39:50 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:39:50 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:39:50 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:39:50 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:39:51 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:39:51 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:39:51 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 17:39:51 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 17:39:51 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:39:51 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.02s
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.001s, status=ok
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.028s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.259s, null_city=4304
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.041s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.166s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:39:51 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.073s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:39:52 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.994s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:39:52 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 17:39:52 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.047s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:39:52 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.057s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:39:52 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.034s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:39:52 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.217s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.036s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.148s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.030s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:39:53 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.184s
2025-12-19 17:39:53 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.19s
2025-12-19 17:39:53 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 17:39:53 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:39:53 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.40s, groups=10
2025-12-19 17:39:53 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:40:04 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:40:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:40:05 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:40:05 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:40:05 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:40:05 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:40:05 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:40:05 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.45s, races=5
2025-12-19 17:40:05 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:40:05 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:40:05 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:40:05 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.032s
2025-12-19 17:40:05 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 17:42:52 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:42:52 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:42:52 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.02s
2025-12-19 17:42:52 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:42:52 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:42:52 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.256s, null_city=4304
2025-12-19 17:42:52 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.058s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:42:52 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:42:53 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.186s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:42:53 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.076s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.925s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:42:54 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.054s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.066s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.037s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.248s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.038s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.151s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.032s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:42:54 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.191s
2025-12-19 17:42:54 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.20s
2025-12-19 17:42:54 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 17:42:55 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:42:55 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.41s, groups=10
2025-12-19 17:42:55 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:43:06 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:43:06 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:43:06 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.43s, races=5
2025-12-19 17:43:07 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:43:07 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:43:07 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:43:07 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.054s
2025-12-19 17:43:07 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.11s, validation_year=2025
2025-12-19 17:44:46 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:44:46 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:44:46 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.256s, null_city=4304
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.065s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.012s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.189s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:44:46 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.086s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:44:47 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.916s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:44:47 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.004s)
2025-12-19 17:44:47 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.045s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:44:47 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.053s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:44:47 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.031s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:44:47 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.200s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.028s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.126s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.025s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:44:48 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.083s
2025-12-19 17:44:48 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.09s
2025-12-19 17:44:48 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 17:44:48 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:44:48 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.41s, groups=10
2025-12-19 17:44:48 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:45:00 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:45:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:45:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:45:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:45:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:45:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:45:01 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:45:01 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.43s, races=5
2025-12-19 17:45:01 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:45:01 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:45:01 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:45:01 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.038s
2025-12-19 17:45:01 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 17:49:45 | INFO     | root                 | === Логирование включено ===
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:49:45 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:49:45 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.275s, null_city=4304
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.082s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.013s, na_birth_year=0, unique_birth_years=73
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.276s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 17:49:45 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.071s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 17:49:46 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.924s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 17:49:46 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 17:49:46 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.058s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 17:49:46 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.073s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 17:49:46 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.044s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.228s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.029s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.139s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.030s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 17:49:47 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.281s
2025-12-19 17:49:47 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.29s
2025-12-19 17:49:47 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.11s, validation_year=2025
2025-12-19 17:49:48 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 17:49:48 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.49s, groups=10
2025-12-19 17:49:48 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 17:49:59 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 17:49:59 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 17:49:59 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.59s, races=5
2025-12-19 17:49:59 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 17:49:59 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 17:49:59 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 17:49:59 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.035s
2025-12-19 17:49:59 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 18:14:24 | INFO     | root                 | === Логирование включено ===
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 18:14:24 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.11s
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 18:14:24 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.02s
2025-12-19 18:14:24 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 18:14:24 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.008s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 18:14:24 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.397s, null_city=4304
2025-12-19 18:14:24 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.077s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 18:14:24 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.020s, na_birth_year=0, unique_birth_years=73
2025-12-19 18:14:25 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.287s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 18:14:25 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.122s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.032s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 18:14:26 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.017s)
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.054s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.068s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.043s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.290s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 18:14:26 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.038s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 18:14:27 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 18:14:27 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.176s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 18:14:27 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.041s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 18:14:27 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.739s
2025-12-19 18:14:27 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.75s
2025-12-19 18:14:27 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.11s, validation_year=2025
2025-12-19 18:14:27 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 18:14:27 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.59s, groups=10
2025-12-19 18:14:28 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 18:15:14 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 18:15:14 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 18:15:14 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.75s, races=5
2025-12-19 18:15:15 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 18:15:15 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:03:28 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:03:28 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:03:28 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:03:28 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:03:28 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:03:28 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:03:28 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:03:29 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:03:29 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:03:29 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.007s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.244s, null_city=4304
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.038s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.148s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:03:29 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.065s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.861s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:03:30 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.008s)
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.044s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.031s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.144s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.027s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.119s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.022s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:03:30 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.845s
2025-12-19 19:03:30 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.85s
2025-12-19 19:03:30 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 19:03:31 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:03:31 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.32s, groups=10
2025-12-19 19:03:31 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:03:42 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:03:42 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:03:42 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.45s, races=5
2025-12-19 19:03:42 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:03:42 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:03:42 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:03:42 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.033s
2025-12-19 19:03:42 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:12:39 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:12:39 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:12:39 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:12:40 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.007s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.248s, null_city=4304
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.038s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.149s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:12:40 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.063s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.863s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:12:41 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.004s)
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.045s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.054s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.030s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.160s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.027s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.103s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:12:41 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.843s
2025-12-19 19:12:41 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.85s
2025-12-19 19:12:41 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 19:12:42 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:12:42 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.40s, groups=10
2025-12-19 19:12:42 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:12:53 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:12:54 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:12:54 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:12:54 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:12:54 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:12:54 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:12:54 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:12:54 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.41s, races=5
2025-12-19 19:12:54 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:12:54 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:12:54 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:12:54 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.033s
2025-12-19 19:12:54 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 19:13:43 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:13:43 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:13:43 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:13:43 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:13:43 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:13:43 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.242s, null_city=4304
2025-12-19 19:13:44 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.039s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:13:44 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:13:44 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.138s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:13:44 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.063s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.856s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:13:45 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.042s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.050s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.027s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.160s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.022s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.108s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.022s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:13:45 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.812s
2025-12-19 19:13:45 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.82s
2025-12-19 19:13:45 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.06s, validation_year=2025
2025-12-19 19:13:45 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:13:45 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.35s, groups=10
2025-12-19 19:13:46 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:13:56 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:13:56 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:13:56 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:13:56 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:13:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:13:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:13:57 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:13:57 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.40s, races=5
2025-12-19 19:13:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:13:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:13:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:13:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.034s
2025-12-19 19:13:57 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:21:18 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:21:18 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:21:18 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:21:18 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:21:19 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:21:19 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:21:19 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:21:19 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:21:19 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:21:19 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.007s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.250s, null_city=4304
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.037s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.151s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:21:19 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.074s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.885s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:21:20 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.006s)
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.050s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.059s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.033s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.195s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:21:20 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.032s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:21:21 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:21:21 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.136s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:21:21 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.035s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:21:21 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.993s
2025-12-19 19:21:21 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.00s
2025-12-19 19:21:21 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:21:21 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:21:21 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.45s, groups=10
2025-12-19 19:21:21 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:21:33 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:21:33 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:21:33 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.41s, races=5
2025-12-19 19:21:33 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:21:33 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:21:33 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:21:33 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.039s
2025-12-19 19:21:33 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 19:24:29 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:24:29 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:24:29 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:24:29 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:24:30 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:24:30 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:24:30 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:24:30 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:24:30 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:24:30 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.242s, null_city=4304
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.035s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.135s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:24:30 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.062s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.864s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:24:31 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.006s)
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.043s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.029s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.154s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.023s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.107s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:24:31 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.812s
2025-12-19 19:24:31 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.81s
2025-12-19 19:24:31 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.06s, validation_year=2025
2025-12-19 19:24:32 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:24:32 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.31s, groups=10
2025-12-19 19:24:32 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:24:42 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:24:43 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:24:43 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:24:43 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:24:43 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:24:43 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:24:43 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:24:43 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.41s, races=5
2025-12-19 19:24:43 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:24:43 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:24:43 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:24:43 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.032s
2025-12-19 19:24:43 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:25:54 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:25:54 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:25:54 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:25:54 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:25:54 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:25:54 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.248s, null_city=4304
2025-12-19 19:25:54 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.039s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:25:54 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:25:55 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.147s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:25:55 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.071s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.910s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:25:56 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.077s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.089s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.038s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.187s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.031s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.127s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.029s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:25:56 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.031s
2025-12-19 19:25:56 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.04s
2025-12-19 19:25:56 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:25:57 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:25:57 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.36s, groups=10
2025-12-19 19:25:57 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:26:08 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:26:09 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:26:09 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.45s, races=5
2025-12-19 19:26:09 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:26:09 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:26:09 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:26:09 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.041s
2025-12-19 19:26:09 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:26:57 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:26:57 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:26:57 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:26:57 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:26:57 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.008s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:26:57 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.273s, null_city=4304
2025-12-19 19:26:57 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.041s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:26:57 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:26:58 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.170s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:26:58 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.065s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.000s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:26:59 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.006s)
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.063s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.075s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.059s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.223s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.039s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.190s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.034s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:26:59 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.303s
2025-12-19 19:26:59 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.31s
2025-12-19 19:27:00 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.12s, validation_year=2025
2025-12-19 19:27:00 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:27:00 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.41s, groups=10
2025-12-19 19:27:00 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:27:11 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:27:11 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:27:11 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:27:12 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:27:12 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:27:12 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:27:12 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:27:12 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.47s, races=5
2025-12-19 19:27:12 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:27:12 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:27:12 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:27:12 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.037s
2025-12-19 19:27:12 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 19:27:33 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:27:33 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:27:33 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:27:33 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:27:33 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:27:33 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.251s, null_city=4304
2025-12-19 19:27:34 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.040s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:27:34 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:27:34 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.147s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:27:34 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.071s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.907s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:27:35 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.045s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.053s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.038s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.223s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.032s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.119s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.023s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:27:35 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.024s
2025-12-19 19:27:35 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.03s
2025-12-19 19:27:35 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:27:36 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:27:36 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.36s, groups=10
2025-12-19 19:27:36 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:27:47 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:27:47 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:27:47 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.41s, races=5
2025-12-19 19:27:47 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:27:47 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:27:47 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:27:47 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.031s
2025-12-19 19:27:47 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:28:47 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:28:47 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:28:47 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:28:47 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:28:47 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:28:47 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.280s, null_city=4304
2025-12-19 19:28:47 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.055s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:28:48 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.011s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:28:48 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.188s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:28:48 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.085s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:28:49 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.290s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:28:49 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.012s)
2025-12-19 19:28:49 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.087s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:28:49 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.103s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:28:49 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.048s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:28:49 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.340s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.036s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.150s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.036s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:28:50 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.748s
2025-12-19 19:28:50 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.75s
2025-12-19 19:28:50 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:28:50 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:28:50 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.37s, groups=10
2025-12-19 19:28:51 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:29:01 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:29:01 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:29:02 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:29:02 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:29:02 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:29:02 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:29:02 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:29:02 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.43s, races=5
2025-12-19 19:29:02 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:29:02 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:29:02 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:29:02 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.032s
2025-12-19 19:29:02 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:31:50 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:31:50 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:31:50 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.007s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.248s, null_city=4304
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.041s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.148s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:31:50 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.068s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:31:51 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.865s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:31:51 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:31:51 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.044s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:31:51 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.052s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:31:51 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.032s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:31:51 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.167s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.029s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.110s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.020s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:31:52 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.879s
2025-12-19 19:31:52 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.88s
2025-12-19 19:31:52 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.06s, validation_year=2025
2025-12-19 19:31:52 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:31:52 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.36s, groups=10
2025-12-19 19:31:52 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:32:03 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:32:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:32:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:32:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:32:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:32:04 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:32:04 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:32:04 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.42s, races=5
2025-12-19 19:32:04 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:32:04 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:32:04 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:32:04 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.034s
2025-12-19 19:32:04 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:40:24 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:40:24 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:40:24 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:40:24 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:40:24 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:40:24 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.255s, null_city=4304
2025-12-19 19:40:24 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.046s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:40:24 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:40:25 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.172s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:40:25 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.077s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.022s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:40:26 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.063s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.076s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.045s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.205s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.036s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.112s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.020s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:40:26 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.188s
2025-12-19 19:40:26 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.19s
2025-12-19 19:40:26 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:40:27 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:40:27 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.43s, groups=10
2025-12-19 19:40:53 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:40:53 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.08s
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.03s
2025-12-19 19:40:53 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:40:53 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:40:53 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.008s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:40:54 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.282s, null_city=4304
2025-12-19 19:40:54 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.051s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:40:54 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:40:54 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.195s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:40:54 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.084s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.975s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:40:55 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.045s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.052s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.031s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.171s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.024s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:40:55 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.114s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:40:56 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.020s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:40:56 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.106s
2025-12-19 19:40:56 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.11s
2025-12-19 19:40:56 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:40:56 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:40:56 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.35s, groups=10
2025-12-19 19:41:16 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:41:16 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.08s
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:41:16 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.007s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.254s, null_city=4304
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.052s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.008s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.154s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:41:16 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.080s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:41:17 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.007s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:41:17 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.047s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.055s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.034s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.179s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.030s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.112s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:41:18 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.086s
2025-12-19 19:41:18 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.09s
2025-12-19 19:41:18 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 19:41:18 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:41:18 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.34s, groups=10
2025-12-19 19:41:19 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:41:30 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:41:30 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:42:03 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:42:03 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:42:03 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:42:03 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:42:03 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:42:03 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.287s, null_city=4304
2025-12-19 19:42:03 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.051s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:42:03 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:42:04 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.187s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:42:04 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.069s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.916s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:42:05 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.050s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.058s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.029s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.168s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.025s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.106s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.022s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:42:05 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.017s
2025-12-19 19:42:05 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.02s
2025-12-19 19:42:05 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:42:06 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:42:06 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.36s, groups=10
2025-12-19 19:42:06 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:42:17 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:42:18 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:42:18 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.51s, races=5
2025-12-19 19:42:18 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:42:18 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:42:18 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:42:18 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.032s
2025-12-19 19:42:18 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:44:30 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:44:30 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:44:30 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:44:30 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:44:30 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:44:31 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.249s, null_city=4304
2025-12-19 19:44:31 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.045s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:44:31 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:44:31 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.146s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:44:31 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.069s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.900s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:44:32 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.047s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.057s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.034s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.206s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.030s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.132s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.034s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:44:32 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.008s
2025-12-19 19:44:32 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.01s
2025-12-19 19:44:32 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 19:44:33 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:44:33 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.38s, groups=10
2025-12-19 19:44:33 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:45:11 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:45:11 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:45:11 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:45:11 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:45:11 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:45:12 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.286s, null_city=4304
2025-12-19 19:45:12 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.051s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:45:12 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.012s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:45:12 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.234s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:45:12 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.066s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.067s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:45:13 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.007s)
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.050s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.060s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.065s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:45:13 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.197s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:45:14 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.047s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:45:14 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:45:14 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.131s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:45:14 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.028s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:45:14 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.395s
2025-12-19 19:45:14 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.40s
2025-12-19 19:45:14 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:45:14 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:45:14 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.42s, groups=10
2025-12-19 19:45:14 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:45:28 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:45:28 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:45:28 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.40s, races=5
2025-12-19 19:45:28 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:45:28 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:45:28 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:45:28 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.046s
2025-12-19 19:45:28 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 19:47:41 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:47:41 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:47:41 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.011s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.297s, null_city=4304
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.055s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.195s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:47:41 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.098s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.190s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:47:43 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.071s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.085s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.048s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.232s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.035s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.170s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.040s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:47:43 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.584s
2025-12-19 19:47:43 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.59s
2025-12-19 19:47:43 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:47:44 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:47:44 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.45s, groups=10
2025-12-19 19:47:44 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:47:56 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:47:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:47:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:47:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:47:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:47:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:47:57 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:47:57 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.45s, races=5
2025-12-19 19:47:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:47:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:47:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:47:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.038s
2025-12-19 19:47:57 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.10s, validation_year=2025
2025-12-19 19:48:43 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:48:43 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:48:43 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.263s, null_city=4304
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.054s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.009s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.164s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:48:43 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.080s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.900s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:48:44 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.004s)
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.042s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.029s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:48:44 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.147s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:48:45 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.023s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:48:45 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:48:45 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.106s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:48:45 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.020s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:48:45 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 1.930s
2025-12-19 19:48:45 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 1.93s
2025-12-19 19:48:45 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.05s, validation_year=2025
2025-12-19 19:48:45 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:48:45 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.35s, groups=10
2025-12-19 19:48:45 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:48:57 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:48:57 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:48:57 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.50s, races=5
2025-12-19 19:48:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:48:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:48:57 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:48:57 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.049s
2025-12-19 19:48:57 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.12s, validation_year=2025
2025-12-19 19:52:51 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:52:51 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:52:51 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:52:51 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:52:51 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.006s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:52:52 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.315s, null_city=4304
2025-12-19 19:52:52 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.069s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:52:52 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.007s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:52:52 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.206s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:52:52 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.077s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.981s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:52:53 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.051s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.061s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.032s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.173s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:52:53 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.026s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:52:54 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:52:54 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.110s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:52:54 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:52:54 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.170s
2025-12-19 19:52:54 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.17s
2025-12-19 19:52:54 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:52:54 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:52:54 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.42s, groups=10
2025-12-19 19:52:54 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:53:37 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:53:37 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.06s
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.02s
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.02s
2025-12-19 19:53:37 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:53:37 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:53:37 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:53:38 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.254s, null_city=4304
2025-12-19 19:53:38 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.050s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:53:38 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.006s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:53:38 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.179s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:53:38 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.066s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 1.129s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:53:39 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.007s)
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.063s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.080s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.037s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:53:39 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.224s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:53:40 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.035s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:53:40 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:53:40 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.122s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:53:40 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:53:40 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.314s
2025-12-19 19:53:40 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.32s
2025-12-19 19:53:40 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.07s, validation_year=2025
2025-12-19 19:53:40 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:53:40 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.33s, groups=10
2025-12-19 19:53:40 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:53:51 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:53:51 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:53:51 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.41s, races=5
2025-12-19 19:53:51 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:53:51 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:53:51 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:53:51 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.034s
2025-12-19 19:53:51 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
2025-12-19 19:57:07 | INFO     | root                 | === Логирование включено ===
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | DataLoader class: DataLoader.data_loader.DataLoader
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | DataLoader file: C:\Users\andre\github\Marathons\DataLoader\data_loader.py
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | DataLoader OUTPUT_COLUMNS: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:57:07 | INFO     | DataLoader.data_loader | DataLoader: загружен кэш data_cache.parquet
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | df columns: ['surname', 'name', 'race_id', 'year', 'gender', 'age', 'time_seconds', 'status', 'city', 'bib_number', 'distance_km']
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | load_data: rows 0 → 53142, elapsed 0.07s
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | filter_raw: rows 53142 → 42443, elapsed 0.01s
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | validate_raw: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:57:07 | INFO     | MarathonAgeModel     | add_row_id: rows 42443 → 42443, elapsed 0.01s
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | validate_input_contract:, rows 42443 → 42443, dropped 0, elapsed 0.000s, status=ok
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | ensure_optional_columns:, rows 42443 → 42443, dropped 0, elapsed 0.005s, added_city=False, added_bib_number=False, added_distance_km=False
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | normalize_core_strings:, rows 42443 → 42443, dropped 0, elapsed 0.294s, null_city=4304
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | build_person_base_key:, rows 42443 → 42443, dropped 0, elapsed 0.056s, nunique_ordered_key=23418, nunique_set_key=23239, swap_cases=42437
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | compute_approx_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.013s, na_birth_year=0, unique_birth_years=73
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | stabilize_birth_year:, rows 42443 → 42443, dropped 0, elapsed 0.187s, na_birth_year_stable=0, na_birth_cluster_id=0
2025-12-19 19:57:07 | INFO     | Preprocessor.preprocessor | assign_runner_id:, rows 42443 → 42443, dropped 0, elapsed 0.080s, nunique_runner_id=25037, max_group_size=29, suspicious_multi_start_rows=216, mode=set_key_with_birth_year_stable_and_cluster
2025-12-19 19:57:08 | INFO     | Preprocessor.preprocessor | normalize_city_names:, rows 42443 → 42443, dropped 0, elapsed 0.969s, changed_rows=8327, unique_before=2490, unique_after=2103
2025-12-19 19:57:08 | INFO     | utils.city_normalizer | dump_unrecognized_cities: dumped 200 cities to C:\Users\andre\github\Marathons\test_outputs\unrecognized_cities_top.txt (elapsed 0.005s)
2025-12-19 19:57:08 | INFO     | Preprocessor.preprocessor | compute_city_mode_per_runner:, rows 42443 → 42443, dropped 0, elapsed 0.055s, runners_with_single_city=21912, potential_fill_rows=35149
2025-12-19 19:57:08 | INFO     | Preprocessor.preprocessor | fill_city_within_runner:, rows 42443 → 42443, dropped 0, elapsed 0.065s, actual_filled_rows=2071, remaining_na_city=2241
2025-12-19 19:57:08 | INFO     | Preprocessor.preprocessor | split_runner_id_by_city_when_conflicted:, rows 42443 → 42443, dropped 0, elapsed 0.041s, changed_rows=5053, affected_runner_ids=1405
2025-12-19 19:57:08 | INFO     | Preprocessor.preprocessor | after_city_split: event_multi_rows=80
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority report saved: C:\Users\andre\github\Marathons\test_outputs\gender_fixes.txt
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority changed winners (top 30):
                                     runner_id  F  M  total winner
                  ALEKSANDR|TARASOV_1984_M1984  1  7      8      M
  IVANOV|IVAN_1985_M1983__CITY_Санкт-Петербург  1  7      8      M
                  ANDREI|OVCHARENKO_1980_M1980  1  4      5      M
                      PAVEL|SMIRNOV_1982_M1982  1  4      5      M
                   BELYAKOV|DMITRII_1985_M1985  1  3      4      M
                 ALEKSEI|TETYUSHKIN_1984_M1984  1  2      3      M
 ALMAZ|GALIAKHMETOV_1974_M1974__CITY_Волгоград  1  2      3      M
                       DANIIL|DANIK_1982_M1982  1  2      3      M
MAMEDOV|VUSAL_1989_M1989__CITY_Санкт-Петербург  1  2      3      M
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority removed ambiguous (top 30):
                 runner_id  F  M  total winner
DMITRII|SOZONOV_1970_M1970  1  1      2   <NA>
 IRINA|LEBEDEVA_1985_M1985  1  1      2   <NA>
  MAKSIM|SINKIN_1983_M1983  1  1      2   <NA>
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | fix_gender_by_majority:, rows 42443 → 42437, dropped 6, elapsed 0.165s, removed_rows=6, removed_runner_ids=3, changed_rows=9
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | deduplicate_strict:, rows 42437 → 42437, dropped 0, elapsed 0.028s, removed_rows=0, duplicate_groups=0, bib_fill_rate=1.000, bib_used=True, key_cols=runner_id|race_id|year|time_seconds|bib_number
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi: leftover event_multi rows=6
                          runner_id       race_id  year  bib_number  city  age  time_seconds
19534  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        4735  <NA>   40       17460.0
19583  ALEKSANDR|KALININ_1982_M1981  Дорога жизни  2022        3697  <NA>   39       17740.0
18619      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        4771  <NA>   45       13359.0
19223      ANDREI|PETROV_1977_M1976  Дорога жизни  2022        5027  <NA>   45       15931.0
18492      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4121  <NA>   34       12516.0
19033      ANDREI|PETROV_1987_M1987  Дорога жизни  2022        4992  <NA>   34       15088.0
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | drop_ambiguous_event_multi:, rows 42437 → 42357, dropped 80, elapsed 0.112s, removed_rows=80, removed_ambiguous=74, removed_leftover=6, removed_share=0.001885
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | add_features:, rows 42357 → 42357, dropped 0, elapsed 0.021s, age_center=35.0, age_scale=10.0, age_min_global=18.0, age_max_global=80.0
2025-12-19 19:57:09 | INFO     | Preprocessor.preprocessor | preprocess_total:, rows 42443 → 42357, dropped 86, elapsed 2.133s
2025-12-19 19:57:09 | INFO     | MarathonAgeModel     | preprocess: rows 42443 → 42357, elapsed 2.14s
2025-12-19 19:57:09 | INFO     | MarathonAgeModel     | build_train_frame_loy: rows 42357 → 36205, elapsed 0.09s, validation_year=2025
2025-12-19 19:57:09 | INFO     | trace_reference_builder | ReferenceBuilder: построено 10 эталонов
2025-12-19 19:57:09 | INFO     | MarathonAgeModel     | build_trace_references: rows 36205 → 10, elapsed 0.39s, groups=10
2025-12-19 19:57:10 | INFO     | trace_reference_builder | Trace references saved: C:\Users\andre\github\Marathons\test_outputs\trace_references.xlsx, rows=10
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder config: min_group_size=10, bootstrap_samples=500, random_seed=456
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 93 возрастных медиан
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 92 возрастных медиан
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 89 возрастных медиан
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 52 возрастных медиан
2025-12-19 19:57:21 | INFO     | age_reference_builder | AgeReferenceBuilder: построено 9 возрастных медиан
2025-12-19 19:57:21 | INFO     | age_reference_builder | Age references saved: C:\Users\andre\github\Marathons\test_outputs\age_references.xlsx, rows=335
2025-12-19 19:57:21 | INFO     | MarathonAgeModel     | build_age_references: rows 36205 → 335, elapsed 0.44s, races=5
2025-12-19 19:57:21 | INFO     | spline_model.age_spline_fit | AgeSplineFitter initialized: age_center=35.0, age_scale=10.0, degree=3, lambda_method=FIXED
2025-12-19 19:57:21 | INFO     | spline_model.age_spline_fit | fit_gender: gender=M, n=29450
2025-12-19 19:57:21 | INFO     | spline_model.age_spline_fit | fit_gender: gender=F, n=6755
2025-12-19 19:57:21 | INFO     | spline_model.age_spline_fit | AgeSplineFitter.fit: completed genders=['M', 'F'] in 0.033s
2025-12-19 19:57:21 | INFO     | MarathonAgeModel     | fit_age_model: rows 42357 → 36205, elapsed 0.08s, validation_year=2025
